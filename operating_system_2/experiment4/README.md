# 实验（四）文件操作与管理

# 一、目的与要求

## 1、目的

随着社会信息量的极大增长，要求计算机处理的信息与日俱增，涉及到社会生活的各个方面。因此，文件管理是操作系统的一个极为重要的组成部分。学生应独立地用高级语言编写和调试一个简单的文件系统，模拟文件管理的工作过程。从而对各种文件操作命令的实质内容和执行过程有比较深入的了解，掌握它们的实施方法，加深理解课堂上讲授过的知识。

## 2、要求

1. 实际一个n个用户的文件系统，每个用户最多可保存m个文件。
2. 限制用户在一次运行中只能打开l个文件。
3. 系统应能检查打入命令的正确性，出错要能显示出错原因。
4. 对文件必须设置保护措施，如只能执行，允许读、允许写等。在每次打开文件时，根据本次打开的要求，再次设置保护级别，即可有二级保护。
5. 对文件的操作至少应有下述几条命令
   - create
      - 建立文件
   - delete
      - 删除文件
   - open
      - 打开文件
   - close
      - 关闭文件
   - read
      - 读文件
   - write
      - 写文件

# 二、示例

# 1、题目

1. 本实习设计一个10个用户的文件系统，每个用户最多可保存10个文件，一次运行中用户可打开5个文件。
2. 程序采用二级文件目录，即设置了主文件目录（MFD）和用户文件目录（UFD）。前者应包含文件主（即用户）及他们的目录区指针；后者应给出每个文件主占有的文件目录，即文件名，保护码，文件长度以及他们存放的位置等。另外为打开文件设置了运行文件目录（AFD），在文件打开时应填入打开文件号，本次打开保护码和读写指针等。
3. 为了便于实现，对文件的读写作了简化，在执行读写命令时，只修改读写指针，并不进行实际文件的读写操作。

## 2、算法与框图

1. 因系统小，文件目录的检索使用了简单的线性搜索，而没有采用Hash等有效算法。
2. 文件保护简单实用了三位保护码，对应于允许读、允许写和运行执行，如下所示：

| 1 | 1 | 1 |
| :-: | :-: | :-: |
| 允许写 | 允许读 | 允许执行 |

如对应位为0，则不允许

本程序用交互方式工作。启动程序后，系统查询：YOURNAME?打入用户名，且已登入主目录时，系统就响应。

注意，本程序中前一个编入登录用户名的程序，用户需实现在主目录中登入用户名。系统响应后会给出用户文件目录，然后显示：COMMANDNAME?打入相应命令后就可建立、删除、读、写、打开和关闭文件，如命令打错，系统会指出并给用户提示。操作完成后应关闭文件，然后打入“BYE”命令退出文件系统。退出前系统再次打印当前文件目录。

## 4、小结

文件系统的管理有各种各样的方案和算法。由于实习时间和条件的限制，本示例只是简单的模拟了文件的几种操作命令，学生可从各种管理程序和数据库管理的实习中进一步深入探讨。

# 三、实习题

1. 编制和调试示例给出的文件操作与管理程序，并使其投入运行。
2. 增加2～3个文件操作命令，并加以实现。
   - 提示：可以增加移动读写指针命令，如把指针移至某一起始位置或文件头；改变文件属性的命令，如更改文件名，改变文件保护级别等。

# 四、思考题

1. 编制一个通过屏幕选择命令的文件管理系统，每幅屏幕要为用户提供足够的选择信息，不需要打入冗长的命令。
   - 提示：为了便于用户操作，微机大多采用按照屏幕的提示选择命令，这里可以使用高级语言编制通过屏幕显示选择文件操作命令的文件管理模拟程序。
2. 设计一个树形目录结构的文件系统，其根目录为root，各分支可以是目录，也可以是文件，最后的叶子都是文件。
   - 提示：可以参考UNIX操作系统的文件结构和管理方法。可采用多级保护，即把用户分成文件主，伙伴和普通用户三类，分别给予使用权。为了缩短搜索文件的路径，可设置工作目录（或值班目录），使能在当前使用的目录下查找文件，不必每次都从根目录开始查找。
3. 根据学校的各级机构，编制一个文件系统，要求上级机构能查阅和修改下级机构的文件，而下级机构只有在授权情况下才能查阅上级的文件，但不能修改，同一级的文件可以共享。
   - 提示：学校机构可由如下图7组成。
