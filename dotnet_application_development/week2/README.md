# 第 2 周实验

# 实验 1：单步调试技术

## 实验目的
单步调试技术和简单应用。从本章单步调试技术的介绍中可以发现，使用单步调试可以观察语句、方法以及整个程序组织的逻辑细节，核对是否符合我们想要做的事，所以它可以作为学习的辅助工具。

## 实验内容
使用单步调试技术了解 `foreach` 语句的功能和运行过程。即使还没有学过 `foreach` 语句，我们仍然可以通过单步调试技术，很清楚地观察它究竟是怎样工作的。

## 实验步骤
1. 在 IDE 中创建一个控制台应用程序项目；输入下面的程序：
```csharp
using System;
namespace Debug2
{
    public class Debug2
    {
        public static void Main()
        {
            int [,] arrInt = {{1, 2}, {3, 4}};
            for(int j = 0; j <= 1; j++)
                for(int k = 0; k <= 1; k++)
                    Console.WriteLine("arrInt[{0},{1}]={2}", j, k, arrInt[j,k]);
            foreach(int s in arrInt)
                Console.WriteLine(s);
        }
    }
}
```
2. 运行程序，排除错误，获得正确的输出。
3. 在“调试”菜单中选择“逐语句”命令，进入调试状态进行单步调试，观察 `for` 语句和 `foreach` 语句执行的差别。

## 实验报告

写出执行 `foreach` 语句时，每一步所执行的内容（即，具有底色突显的部分）。

# 实验 2：使用断点调试技术

## 实验目的和内容
通过调试一个简单的 Windows 应用程序，熟悉使用断点的技术，并观察程序运行到断点时的执行过程；熟悉主要的观察窗口。

## 第 1 部分

### 实验步骤

> 建立一个 Windows 应用程序。

1. 建立一个 Windows 应用程序项目 `WinDebug1`；
2. 在窗体 `Form1` 中加入三个标签，三个文本框和一个按钮。`textBox1`、`textBox2` 和 `textBox3` 是三个文本框的名字，也是程序中辨认它们的标识符；同样的道理，`label1`、`label2` 和`label3` 是三个标签的名称，它们的 `Text` 属性值分别为“操作数 1”、“操作数 2”和“结果”；按钮的名称是 `button1`，它的 `Text` 属性值设置为“联接”。
有时从用户界面的角度，根据标签的功能，用标签的文本称呼被标签指示的对象，例如，把 `textBox1` 称为操作数 1 文本框。
3. 双击“联接”按钮，进入到源代码窗体 `Form1.cs`；并且光标的位置在 `botton1_Click_1`方法中。在这个位置上加入代码，使得 `botton1_Click_1` 完整的代码如下：
```csharp
private void button1_Click_1(object sender, System.EventArgs e)
{
    textBox3.Text = textBox1.Text + textBox2.Text;
}
```
4. 从“调试”菜单中选择“开始执行（不调试）”命令，执行程序后弹出 `Form1` 窗体，在操作数 1 和操作数 2 文本框中输入“北京”、“上海”，单击“联接”按钮，观察“结果”文本框中的输出结果。
5. 重新在操作数 1 和操作数 2 文本框中分别输入数值 01234 和 56789；单击“联接”按钮。

### 实验报告

写出步骤 4 和 5 结束后，“结果”文本框中的内容。如果可能，请解释步骤 5 的输出为什么不是两操作数之和 58023。

## 第 2 部分

> 使用和观察断点，了解监视窗口、局部变量窗口和自动窗口。

1. 在新添加的语句`textBox3.Text = textBox1.Text + textBox2.Text;`左边的指示器边距中单击，产生断点；
2. 在“调试”菜单中选中“启动”；程序运行，弹出 `Form1` 窗体；
3. 输入任意的操作数 1 和操作数 2，例如，147 和 369，然后单击“联接”按钮；
4. 在“调试”菜单的“窗口”子菜单中选择“监视”，单击“监视 1”，单击监视 1 窗口的空行，在“名称”列输入`textBox1.Text`，按 `Enter` 键。用同样的方法输入`textBox2.Text` 和 `textBox3.Text`，观察它们的值；
5. 在“调试”菜单中选择“逐语句”选项或按 `F11` 键，观察监视 1 窗口中三个值；
6. 关闭 `Form1` 窗体，结束调试状态；
7. 重复步骤 2 和 3 ，改用“局部变量”窗口观察 `textBox1.Text`、`textBox2.Text` 和`textBox3.Text` 的值；重复步骤 5 ；
8. 重复步骤 2 和 3 ，改用“自动窗口”观察 `textBox1.Text` 、`textBox2.Text` 和 `textBox3.Text` 的值；重复步骤 5 ；
9. 在“调试”菜单中单击“停止调试”命令，退出调试状态。

### 实验报告

在步骤 3 中，为什么单击“联接”按钮后，`textBox3.Text` 的值并没有改变？自动窗口、局部变量窗口和监视窗口有什么不同？

## 第 3 部分

> 使用快速监视窗口修改变量值

1. 在“调试”菜单中选中“启动”选项；程序运行，弹出 `Form1` 窗体；
2. 输入任意的操作数 1 和操作数 2，例如，“北京”和“广州”，在结果文本框中输入“京广线”，然后单击“联接”按钮；
3. 在“调试”菜单中单击“快速监视”命令，弹出快速监视窗口，在“表达式”下拉列表框中输入新的表达式：
`textBox3.Text=textBox3.Text+"："+textBox1.Text+"到"+textBox2.Text`
4. 单击“重新计算”按钮，在“当前值”显示框中可以看到 `textBox3.Text` 的值是：京广线：北京到广州。单击“关闭”按钮，关闭“快速监视”窗口；
5. 在“自动窗口”中观察三个文本框的 `Text` 值；
6. 选择“调试”菜单中的“逐语句”选项；
7. 在“自动窗口”中观察三个文本框的 `Text` 值的改变。

### 实验报告：

执行步骤 2 的前后，源代码窗体中有什么变化？写出步骤 5 和步骤 7 的结果。

# 实验 3：使用“堆栈调用”窗口

## 实验目的和内容
通过调试一个汉诺（Hanoi）塔的递归程序，熟悉“堆栈调用”窗口，使用“调用堆栈”窗口还可以查看当前在堆栈上的函数或过程调用，查看反汇编代码。

## 实验步骤

### 第 1 部分，建立并运行程序

1. 创建一个控制台应用程序 Debug2；
2. 将下列代码加入到源代码窗口：
```csharp
using System;
public class Hanoi
{
    static void Move(char getone, char putone)
    {
        Console.WriteLine(getone + "-->" + putone);
    }

    static void PlayHanoi(int n, char one, char two, char three)
    {
        if(n == 1)
            Move(one, three);
        else
        {
            PlayHanoi(n-1, one, three, two);
            Move(one, three);
            PlayHanoi(n-1, two, one, three);
        }
    }

    public static void Main()
    {
        int m;
        Console.WriteLine("请输入Hanoi盘的数量：");
        m = Convert.ToInt32(Console.ReadLine());
        Console.WriteLine(m + "个Hanoi盘移动步骤如下：");
        PlayHanoi(m, 'A', 'B', 'C');
    }
}
```
3. 首先了解本程序运行的过程，按 `Ctrl+F5` 组合键，在弹出的窗口中，按照提示输入盘的数量，例如：输入“3”，以后的运行结果如下所示。
```
请输入Hanoi盘的数量：
3
3个Hanoi盘移动步如下：
A-->C
A-->B
C-->B
A-->C
B-->A
B-->C
A-->C
```
4. 按任何键，结束运行。

### 第 2 部分，熟悉“调用堆栈”窗口

5. 在“调试”菜单中，单击“逐语句”选项，程序进入中断状态；
6. 如果“调用堆栈”窗口没有打开，则从“调试”菜单中的“窗口”的级联菜单中单击“调用堆栈”命令。
7. 连续按 `F11` 键，观察“调用堆栈”窗口的显示内容。当弹出窗口时，按照提示输入盘的数量：3。按 `Enter` 键；继续按 `F11` 键并观察“调用堆栈”窗口；

### 第 3 部分，了解“反汇编”窗口

8. 重新从步骤 5 开始，按 `F11` 键，注意当源代码窗体最左边的箭头第 2 次执行第 15 行程序时，右击“调用堆栈”窗口，弹出快捷菜单，选择“转到反汇编”选项，观察原来的源代码窗口，变成了反汇编窗口，观察代码格式；
9. 右单击“调用堆栈”窗口，弹出快捷菜单，选择“转到源代码”，恢复到源代码窗口；

### 第 4 部分，观察程序执行的全过程

10.  在第 17 行设置断点，然后在“调试”菜单中，单击“停止调试”命令；
11.  在“调试”菜单中选择“启动”选项，观察“局部变量”和“调用堆栈”窗口。
12.  按 `F10` 键，进行逐过程调试，观察每次按 `F10` 键后，“局部变量”和“调用堆栈”窗口中的内容。

## 实验报告

1. 步骤 8 后，窗口最左边的箭头指向什么代码？
2. 写出执行步骤 11 和步骤 12 时，“局部变量”和“调用堆栈”窗口中的内容。解释递归程序执行过程的特点。

# 实验 4：简单程序的编制

## 实验内容、步骤和要求

1. 在 SDK 上编制如下功能的控制台应用程序：
   - 提示用户输入用户的姓名，输出“XXX，欢迎您！”字样。要求在“记事本”中编写程序；保存、编译和排错。
2. 在 VS 的 IDE 中编写 Windows 应用程序，功能如下：
   1. 开设一个用户窗体，在窗体上部放入一个标签，提示用户输入一个日期；紧接着标签有三个文本框，分别接受年，月，日的输入；
   2. 窗体中部有一个命令按钮，标题为：DAY；
   3. 窗体下部有一个文本框用来显示该日期是星期几。例如，用户输入某年的某一日期后，单击按钮，底部的文本框中将显示该日期是星期几，为了简化问题，规定只能输入今年的日期。

# 实验 5：关于相等性问题

## 实验目的和内容

通过运行一段程序，理解 `Object` 中值类型和引用类型对象的相等性概念

## 实验步骤

1. 阅读下列程序，写出预测的输出结果；
2. 输入下列程序、调试并使之正确运行，产生结果；
3. 解释其中的语法现象。
```csharp
using System;
public class t2_1
{
    static void Main(string[] args)
    {
        int a = 1, b = 1;
        float f = 1.0f;
        if (a == b)
            Console.WriteLine(true);
        else
            Console.WriteLine(false);
        Console.WriteLine(Object.Equals(a, b));
        if (a == f)
            Console.WriteLine(true);
        else
            Console.WriteLine(false);
        Console.WriteLine(Object.Equals(a, f));
        object t1 = new object();
        object t2 = new object();
        if (t1 == t2)
            Console.WriteLine(true);
        else
            Console.WriteLine(false);
        Console.WriteLine(Object.Equals(t1, t2));
    }
}
```

## 实验报告：

1. 将预计的输出和实际运行的结果进行比较；
2. 解释每一个输出的语法现象。

# 实验 6：将交错数组转换成一维数组

> 近日见一网友帖子，述其面试时遇一交错数组难题，令该网友惊叹“邪门”、“古怪”、“汗！无脸见人！”。现将该题略作改写，作为一道实验题，借花献佛。相信读者不会觉得困难，甚至大有“No sweat！”之感。衷心祈愿各位读者都有大展才华的好职位！

## 实验内容

编制程序，将一个字符串型交错数据内容按组合规则合并为一个一维数组。

- 输入: 字符串类型的交错数组 `strJaggedArray[][]`；

- 输出: 字符串类型的一维数组 `strArray[]`。由 `strJaggedArray[r][c]`中的元素以"&"为联接符拼合而成，是 `strJaggedArray` 中数组元素的无重复组合(不考虑顺序)。
- 例如:
   - 输入: `strJaggedArray[0]=new string[] {"we","are","student"};`
     `strJaggedArray[1]=new string[] {"say","what"};`
   - 输出：运算后 `strArray[]` 的内容：
     `{"we&say","we&what","are&say","are&what","student&say","student&what"}`
     将其分行输出。

## 实验步骤和要求

1. 理解题意；
2. 编制程序要求:
   - 程序首先提示用户输入 7 个英文单词，将它们分别输入到具有两个一维数组的交错数组 `strJaggedArray` 中；
   - 组合两个数组中的内容，填入到 `strArray` 中；
   - 在屏幕上显示 `strArray` 的内容。

## 实验报告

1. 分析实验内容；
2. 小结技术要点。
