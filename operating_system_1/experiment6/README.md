# 实验六 SHELL 编程

# 一、实验目的

- 掌握vi 的三种工作方式，熟悉vi 编辑程序的使用。 
- 学习Shell 程序设计方法。掌握编程要领。 

# 二、实验准备

- 复习操作系统课程相关的用户接口概念。 
- 熟悉本《实验指导》第三、四部分。 

# 三、实验内容

- 学习使用 `vi` 编辑程序。 
- 编写 Shell 程序。 
- 将程序文件设置为可执行文件（用 `chmod` 命令）。 
- 在命令行方式中运行 Shell 程序。

# 四、实验步骤

1. 按本《实验指导》第三部分的内容。熟悉 `vi` 的三种工作方式。熟悉使用各种编辑功能。
   - 思考：试一试 `vi` 的三种工作方式各用在何时？用什么命令进入插入方式？怎样退出插入方式？文件怎样存盘？注意存盘后的提示信息。
2. 创建和执行 Shell 程序
   - 用前面介绍的Vi 或其他文本编辑器编写Shell 程序，并将文件以文本文件方式保存在相应的目录中。
   - 用chmod 将文件的权限设置为可执行模式，如若文件名为shdemo.h,则命令如下：
   - `$ chmod 755 shdemo.h` (文件主可读、写、执行，同组人和其他人可读和执行)
   - 在提示符后执行 Shell 程序：
   - `$ shdemo.h` （直接键入程序文件名执行）
   - 或 `$ sh shdemo.h` （执行Shell 程序）
   - 或 `$ .shdemo.h` （没有设置权限时可用点号引导）
3. 用 `vi` 编写《实验指导》“第四部分Shell 程序设计”中的例1（假设文件名为prog1.h），练习内部变量和位置参数的用法。
   - 用chmod将文件的权限设置为可执行模式，并在提示符后键入命令行：
   - `$./prog1. #没有参数`
   - 或 `$sh prog1.`
   - 屏幕显示:
   - `Name not provided`
   - 在提示符后键入命令行： 
   - `$./prog1.h Theodore # 有一个参数`
   - 屏幕显示:
   - `Your name is Theodore # 引用$1 参数的效果`
4. 进一步修改程序 `prog1.h`，要求显示参数个数、程序名字，并逐个显示参数。
5. 修改例1程序（即上面的 `prog1.h`），用 `read` 命令接受键盘输入。若没有输入显示第一种提示，否则第二种提示。
6. 用 `vi` 编写《实验指导》“第四部分 Shell 程序设计”中的例2、例3，练习字符串比较运算符、数据比较运算符和文件运算符的用法，观察运行结果。
7. 修改例2程序，使在程序运行中能随机输入字符串，然后进行字符串比较。
8. 修改例3程序，使在程序运行中能随机输入文件名，然后进行文件属性判断。
9. 用 `vi` 编写《实验指导》“第四部分 Shell 程序设计”中的例4、例5、例6、例7，掌握控制语句的用法，观察运行结果。
10. 用 `vi` 编写《实验指导》“第四部分 Shell 程序设计”中的例8及例9掌握条件语句的用法，函数的用法，观察运行结果。
11. 编程，在屏幕上显示用户主目录名（HOME）、命令搜索路径（PATH），并显示由位置参数指定的文件的类型和操作权限。

思考：到此为止你对Shell 有所认识了吧？怎么样？自己再编两个程序：

1. 做个批处理程序，体会一下批处理概念。 
2. 做个菜单，显示系统环境参数。将此程序设置为人人可用。 

# 五、讨论

1. Linux 的 Shell 有什么特点？
2. 怎样进行 Shell 编程？如何运行？有什么条件？
3. `vi` 编辑程序有几种工作方式？查找有关的详细资料，熟练掌握屏幕编辑方式、转移命令方式以及末行命令的操作。学习搜索、替换字符、字和行，行的复制、移动，以及在 `vi` 中执行 Shell 命令的方式。
4. 编写一个具有以下功能的 Shell 程序。
   1. 把当前目录下的文件目录信息输出到文件 `filedir.txt` 中；
   2. 在当前目录下建立一个子目录，目录名为 `testdir2` ；
   3. 把当前目录下的所有扩展名为 `c` 的文件以原文件名复制到子目录 `testdir2`中；
   4. 把子目录中的所有文件的存取权限改为不可读。（提示：用 `for` 循环控制语句实现，循环的控制列表用 `ls` 产生。）
   5. 在把子目录 `testdir2` 中所有文件的目录信息追加到文件 `filedir.txt` 中；
   6. 把你的用户信息追加到文件 `filedir.txt` 中；
   7. 分屏显示文件 `filedir.txt`
